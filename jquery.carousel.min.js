/*! jQuery Carousel Plugin by Thomas Jaggi (2012) - http://github.com/backflip/jquery-carousel/ */
(function(e,f,d,b){var c="carousel",h={getTransitionProperty:function(){var o=f.body||f.documentElement,q="transition",n,l=["Moz","ms","O","Webkit"],p=o.style;if(typeof p[q]==="string"){return q}q=q.charAt(0).toUpperCase()+q.substr(1);for(var m=0;m<l.length;m++){n=l[m]+q;if(typeof p[n]==="string"){return n}}return false},getTransitionEndEvent:function(){var l=h.getTransitionProperty(),m={transition:"transitionEnd",MozTransition:"transitionend",msTransition:"msTransitionEnd",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd"};return m[l]||false},getNamespacedEvents:function(n){var l=n.split(" ");for(var m=0;m<l.length;m++){l[m]=l[m]+"."+c}return l.join(" ")},enableButton:function(l){l.removeClass("state-disabled").removeAttr("aria-disabled").attr("tabindex",0)},disableButton:function(l){l.addClass("state-disabled").attr("aria-disabled",true).attr("tabindex",-1)}},j={touch:"ontouchstart" in e,transition:h.getTransitionProperty()},k=h.getNamespacedEvents(!j.touch?"click keydown":"touchstart"),i=false,a=0;var g=function(m,l){this.$dom={slider:d(m),slides:d(m).children(),container:d('<div class="'+c+'-container" tabindex="0" />'),frame:d('<div class="'+c+'-frame" />'),navContainer:d('<div class="'+c+'-nav" aria-hidden="true" />'),prev:d('<span class="'+c+'-prev" role="button" tabindex="0" />'),next:d('<span class="'+c+'-next" role="button" tabindex="0" />'),counter:d('<div class="'+c+'-counter" aria-hidden="true" />'),handlesContainer:d('<div class="'+c+'-handles" aria-hidden="true" />')};this.props={current:0,total:0,visible:0};this.state={enabled:false,animating:false};this.settings=d.extend(true,{},this.$dom.slider.data(c+"-options"),l)};g.prototype={defaults:{animation:{duration:300,step:1},behavior:{horizontal:true,circular:false,autoplay:0,keyboardNav:true},elements:{prevNext:true,handles:true,counter:true},events:{start:false,stop:false},initialSlide:0,text:{next:"show next slide",prev:"show previous slide",counter:"%current% of %total%",handle:"%index%"},touch:{enabled:true,thresholds:{speed:0.4,distance:0.3}},visibleSlides:1},init:function(){var m=this,l=this.$dom,n=null,o;if(this.$dom.slider.data(c)||this.$dom.slider.length===0){return this}this.index=a++;this.settings=d.extend(true,{},this.defaults,this.settings);o=this._getStyles(l.slider);l.slider.data(c+"-css",o);l.slides.each(function(){var q=d(this),p=m._getStyles(q);q.data(c+"-css",p)});l.container.insertBefore(l.slider);l.frame.appendTo(l.container).append(l.slider.addClass(c+"-slider"));if(this.settings.elements.prevNext){l.prev.appendTo(l.navContainer).text(this.settings.text.prev);l.next.appendTo(l.navContainer).text(this.settings.text.next);l.navContainer.appendTo(l.container);l.nav=l.prev.add(l.next)}if(this.settings.elements.counter){l.counter.appendTo(l.container)}if(this.settings.elements.handles){l.handlesContainer.appendTo(l.container)}l.slides.addClass(c+"-slide");if(this.settings.behavior.circular){l.slides.each(function(p){d(this).data(c+"-index",p)})}if(!this.settings.behavior.horizontal){l.container.addClass(c+"-vertical")}this.update();d(e).on(h.getNamespacedEvents("resize")+this.index,d.proxy(function(){if(n){clearTimeout(n)}n=setTimeout(d.proxy(function(){this.resize()},this),100)},this));l.slider.data(c,this);return this},update:function(l){d.extend(true,this.settings,l);this.$dom.slides=this.$dom.slides.parent().children();this.props.total=this.$dom.slides.length;this.props.current=this.settings.initialSlide;if(this.settings.visibleSlides>0){this.props.visible=this.settings.visibleSlides}else{var m=0,n=this.settings.behavior.horizontal?this.$dom.frame.width():this.$dom.frame.height();this.$dom.slides.each(function(){var o=self.settings.behavior.horizontal?d(this).width():d(this).height();if(o>m){m=o}});this.props.visible=Math.round(n/m)}if(this.settings.elements.handles){this.$dom.handlesContainer.html(this._getHandles());this.$dom.handles=this.$dom.handlesContainer.children()}this.resize();this.enable()},resize:function(){var p=this.$dom.frame.width(),o,m=this.settings.behavior.horizontal?p/this.props.visible:p,l,n=this.settings.behavior.horizontal?this.props.total*m:m;this.$dom.slides.width(m);this.$dom.slider.width(n).height("auto");l=this._getHighestSlide();this.$dom.slides.css("min-height",l);o=this.settings.behavior.horizontal?l:this.props.visible*l;this.$dom.frame.height(o);this.goTo(this.props.current,true)},enable:function(){var l=this;if(this.state.enabled){return}if(this.settings.elements.prevNext){this.$dom.nav.on(k,function(o){var q=d(this),m=q.hasClass("state-disabled"),n,p,r;if(m){return}n=q.is(l.$dom.next)?1:-1;p=n*l.settings.animation.step+l.props.current;r=function(){l.goTo(p)};l._handleButtonEvents(o,q,r)})}if(this.settings.elements.handles){this.$dom.handles.on(k,function(m){var o=d(this),q=o.index(),n=l._getSlideIndex(q),p=function(){l.goTo(n)};l._handleButtonEvents(m,o,p)})}if(this.settings.touch.enabled&&j.touch){this._touchEnable()}if(this.settings.behavior.keyboardNav){this.$dom.container.on(h.getNamespacedEvents("keydown"),d.proxy(function(p){var n=d(p.target),s=n.get(0).nodeName.toLowerCase(),m=d.inArray(s,["input","textarea"])!==-1,r=false;if(!(m||p.metaKey||p.ctrlKey)){var o=p.keyCode||p.which,q;if(d.inArray(o,[37,80])!==-1){this.prev();this.$dom.prev.focus();r=true}else{if(d.inArray(o,[39,78])!==-1){this.next();this.$dom.next.focus();r=true}else{if(47<o&&o<58){q=o-49;this.goTo(q);this.$dom.handles.eq(q).focus();r=true}}}}if(r){this._autoplayDisable();p.preventDefault()}},this))}if(this.settings.behavior.autoplay){this.autoplay=setInterval(function(){l.next()},this.settings.behavior.autoplay)}this.state.enabled=true;this._updateNav()},disable:function(l){if(!this.state.enabled){return}if(this.settings.elements.prevNext){this.$dom.nav.off(k)}if(this.settings.elements.handles){this.$dom.handles.off(k)}if(this.settings.touch.enabled&&j.touch){this._touchDisable()}if(this.settings.behavior.keyboardNav){this.$dom.container.off(h.getNamespacedEvents("keydown"))}if(this.settings.behavior.autoplay){this._autoplayDisable()}this.state.enabled=false;this._updateNav()},goTo:function(p,s){var v=this,q=this._getValidatedTarget(p),o=this._getTargetPosition(q),n=s?0:this.settings.animation.duration,u=function(){if(v.settings.events.stop){v.settings.events.stop(q)}v.state.animating=false},m,l,w,r,t;if(!s){this.state.animating=true;if(this.settings.events.start){this.settings.events.start(q)}if(!j.transition){this.$dom.slider.animate(o,n,function(){u()})}else{m=j.transition;l=this.settings.behavior.horizontal?"left":"top";w=h.getNamespacedEvents(h.getTransitionEndEvent());t=this.$dom.slider.css(m);r=l+" "+n/1000+"s ease-in-out";this.$dom.slider.css(m,r);this.$dom.slider.css(o);this.$dom.slider.on(w,function(){v.$dom.slider.off(w);v.$dom.slider.css(m,t);u()})}}else{this.$dom.slider.css(o)}this.props.current=q;this._updateNav()},next:function(){this.goTo(this.props.current+1)},prev:function(){this.goTo(this.props.current-1)},destroy:function(){var l=this.$dom,m=l.slider.data(c+"-css");l.slider.removeClass(c+"-slider").removeData(c).removeData(c+"-css").insertAfter(l.container).css(m);l.slides.removeClass(c+"-slide").removeData(c+"-index").each(function(){var o=d(this),n=o.data(c+"-css");o.css(n)}).removeData(c+"-css");l.container.remove();this.state.enabled=false;this.props.current=0;d(e).off(h.getNamespacedEvents("resize")+this.index)},_autoplayDisable:function(){clearInterval(this.autoplay);this.autoplay=null},_handleButtonEvents:function(n,l,o){switch(n.type){case"keydown":if(!(n.metaKey||n.ctrlKey)){var m=n.keyCode||n.which;if(d.inArray(m,[13,32])!==-1){o();n.preventDefault()}}break;case"touchstart":i=false;l.on("touchmove."+c,function(){i=true});l.on("touchend."+c,function(){l.off("touchmove."+c);l.off("touchend."+c);if(!i){o()}});break;default:o();break}if(this.settings.behavior.autoplay){this._autoplayDisable()}},_getHandles:function(){var l=f.createDocumentFragment();for(var m=0;m<this.props.total;m++){var n=f.createElement("span");n.className=c+"-handle";n.innerHTML=this.settings.text.handle.replace("%index%",(m+1));n.setAttribute("role","button");n.setAttribute("tabindex",0);l.appendChild(n)}return d(l)},_getHighestSlide:function(){var l=0;this.$dom.slides.each(function(){var m=d(this).css("min-height",0).height();if(m>l){l=m}});return l},_getSlideIndex:function(l,m){if(this.settings.behavior.circular){if(!m){this.$dom.slides.each(function(){var p=d(this),n=p.index(),o=p.data(c+"-index");if(o===l){l=n;return false}})}else{l=this.$dom.slides.eq(l).data(c+"-index")}}return l},_getStyles:function(l){var o=["height","left","min-height","top","width"],n={},p;for(var m=0;m<o.length;m++){n[o[m]]=l.css(o[m])}if(j.transition){p=j.transition.charAt(0).toLowerCase()+j.transition.substr(1);n[p]=l.css(p)}return n},_getTargetPosition:function(l){var n=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),o=this.settings.behavior.horizontal?"left":"top",m={};m[o]=-l*n;return m},_getValidatedTarget:function(n){if(!this.settings.behavior.circular){if(n<0){n=0}else{if(n>=(this.props.total-this.props.visible)){n=this.props.total-this.props.visible}}}else{if(n<0){var l=this.props.total+n;if(this._shiftSlides(l,-1)){return 0}}else{if(n>(this.props.total-this.props.visible)){var m=(n-1)-(this.props.total-this.props.visible);if(this._shiftSlides(m,1)){return n-(m+1)}}}}return n},_shiftSlides:function(n,m){var l=(m===-1)?":gt("+(n-1)+")":":lt("+(n+1)+")",r=this.$dom.slides.filter(l);if(r.length>0){var p=this.settings.behavior.horizontal?"left":"top",s=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),q=this.$dom.slider.position(),o={};o[p]=q[p]+m*r.length*s;if(m===-1){r.prependTo(this.$dom.slider)}else{r.appendTo(this.$dom.slider)}this.$dom.slides=this.$dom.slider.children();this.$dom.slider.css(o);return true}else{return false}},_touchEnable:function(){var l=this,o={start:{x:0,y:0},end:{x:0,y:0}},r={start:0,end:0},q={distance:l.settings.touch.thresholds.distance*l.$dom.frame.width(),speed:l.settings.touch.thresholds.speed*l.$dom.frame.width()},p={top:0,left:0},m={};function n(){var s={x:o.end.x-o.start.x,y:o.end.y-o.start.y};if(!l.settings.behavior.horizontal){s={x:s.y,y:s.x}}return s}m["touchstart."+c]=function(t){var s=t.originalEvent.targetTouches[0];o.start.x=s.pageX;o.start.y=s.pageY;p=l.$dom.slider.position();r.start=new Date().getTime();i=false};m["touchmove."+c]=function(w){var v=w.originalEvent.targetTouches[0],x=0,t={},s=l.settings.behavior.horizontal?"left":"top",u;o.end.x=v.pageX;o.end.y=v.pageY;x=n();if(Math.abs(x.x)>Math.abs(x.y)){u=l.settings.behavior.horizontal?p.left:p.top;t[s]=u+x.x;l.$dom.slider.css(t);i=true;w.preventDefault()}};m["touchend."+c]=function(x){if(!i){return}var t=x.originalEvent.targetTouches[0],z=n(),v,y=l.props.current;if(Math.abs(z.x)>Math.abs(z.y)){r.end=new Date().getTime();v=Math.abs(z.x)/(r.end-r.start)*1000;if(Math.abs(z.x)>q.distance||v>q.speed){var s=l.settings.behavior.horizontal?l.$dom.slides.width():l.$dom.slides.height(),u=(z.x>0)?-1:1,w=Math.abs(Math.round(z.x/s));if(w<1&&v>q.speed){w=1}y=l.props.current+u*w}l.goTo(y)}};this.$dom.frame.on(m)},_touchDisable:function(){this.$dom.frame.off(h.getNamespacedEvents("touchstart touchmove touchend"))},_updateNav:function(){if(this.state.enabled){if(this.settings.elements.prevNext){h.enableButton(this.$dom.prev);h.enableButton(this.$dom.next);if(!this.settings.behavior.circular){if(this.props.current===0){h.disableButton(this.$dom.prev)}else{h.enableButton(this.$dom.prev)}if(this.props.current===this.props.total-this.props.visible){h.disableButton(this.$dom.next)}else{h.enableButton(this.$dom.next)}}}if(this.settings.elements.handles){var l=this._getSlideIndex(this.props.current,true),m=(l>0)?":gt("+(l-1)+"):lt("+this.props.visible+")":":lt("+(l+this.props.visible)+")";h.enableButton(this.$dom.handles);this.$dom.handles.removeClass("state-current");this.$dom.handles.filter(m).addClass("state-current")}}else{if(this.settings.elements.prevNext){h.disableButton(this.$dom.prev);h.disableButton(this.$dom.next)}if(this.settings.elements.handles){h.disableButton(this.$dom.handles)}}if(this.settings.elements.counter){var n=this.props.current+1,p=this.props.current+this.props.visible,o;if(this.settings.behavior.circular){n=this.$dom.slides.eq(this.props.current).data(c+"-index")+1}if(this.props.visible>1){if(p>this.props.total){p=this.props.total}n+="-"+p}o=this.settings.text.counter.replace("%current%",n).replace("%total%",this.props.total);this.$dom.counter.text(o)}}};d.fn[c]=function(m){var l=arguments;return this.each(function(){var o=d(this),n=o.data(c);if(n){if(typeof m==="object"){n.update.apply(n,l)}else{n[m].apply(n,Array.prototype.slice.call(l,1))}}else{new g(this,m).init()}})};e[c.charAt(0).toUpperCase()+c.substr(1)]=g})(window,document,jQuery);