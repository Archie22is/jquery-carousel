/*! jQuery Carousel Plugin by Thomas Jaggi (2012) - http://github.com/backflip/jquery-carousel/ */
(function(d,e,c,a){var b="carousel",g={getTransitionProperty:function(){var n=e.body||e.documentElement,p="transition",m,k=["Moz","ms","O","Webkit"],o=n.style;if(typeof o[p]==="string"){return p}p=p.charAt(0).toUpperCase()+p.substr(1);for(var l=0;l<k.length;l++){m=k[l]+p;if(typeof o[m]==="string"){return m}}return false},getTransitionEndEvent:function(){var k=g.getTransitionProperty(),l={transition:"transitionEnd",MozTransition:"transitionend",msTransition:"msTransitionEnd",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd"};return l[k]||false},getNamespacedEvents:function(m){var k=m.split(" ");for(var l=0;l<k.length;l++){k[l]=k[l]+"."+b}return k.join(" ")},enableButton:function(k){k.removeClass("state-disabled").removeAttr("aria-disabled").attr("tabindex",0)},disableButton:function(k){k.addClass("state-disabled").attr("aria-disabled",true).attr("tabindex",-1)}},i={touch:"ontouchstart" in d,transition:g.getTransitionProperty()},j=g.getNamespacedEvents(!i.touch?"click keydown":"touchstart"),h=false;var f=function(l,k){this.$dom={slider:c(l),slides:c(l).children(),container:c('<div class="'+b+'-container" tabindex="0" />'),frame:c('<div class="'+b+'-frame" />'),navContainer:c('<div class="'+b+'-nav" aria-hidden="true" />'),prev:c('<span class="'+b+'-prev" role="button" tabindex="0" />'),next:c('<span class="'+b+'-next" role="button" tabindex="0" />'),counter:c('<div class="'+b+'-counter" aria-hidden="true" />'),handlesContainer:c('<div class="'+b+'-handles" aria-hidden="true" />')};this.props={current:0,total:0,visible:0};this.state={enabled:false,animating:false};this.settings=c.extend(true,{},this.$dom.slider.data(b+"-options"),k)};f.prototype={defaults:{animation:{duration:300,step:1},behavior:{horizontal:true,circular:false,autoplay:0,keyboardNav:true},elements:{prevNext:true,handles:true,counter:true},events:{start:false,stop:false},initialSlide:0,text:{next:"show next slide",prev:"show previous slide",counter:"%current% of %total%",handle:"%index%"},touch:{enabled:true,thresholds:{speed:0.4,distance:0.3}},visibleSlides:1},init:function(){var l=this,k=this.$dom,m=null,n;if(this.$dom.slider.data(b)||this.$dom.slider.length===0){return this}this.settings=c.extend(true,{},this.defaults,this.settings);n=this._getStyles(k.slider);k.slider.data(b+"-css",n);k.slides.each(function(){var p=c(this),o=l._getStyles(p);p.data(b+"-css",o)});k.container.insertBefore(k.slider);k.frame.appendTo(k.container).append(k.slider.addClass(b+"-slider"));if(this.settings.elements.prevNext){k.prev.appendTo(k.navContainer).text(this.settings.text.prev);k.next.appendTo(k.navContainer).text(this.settings.text.next);k.navContainer.appendTo(k.container);k.nav=k.prev.add(k.next)}if(this.settings.elements.counter){k.counter.appendTo(k.container)}if(this.settings.elements.handles){k.handlesContainer.appendTo(k.container)}k.slides.addClass(b+"-slide");if(this.settings.behavior.circular){k.slides.each(function(o){c(this).data(b+"-index",o)})}if(!this.settings.behavior.horizontal){k.container.addClass(b+"-vertical")}this.update();c(d).on(g.getNamespacedEvents("resize"),c.proxy(function(){if(m){clearTimeout(m)}m=setTimeout(c.proxy(function(){this.resize()},this),100)},this));k.slider.data(b,this);return this},update:function(k){c.extend(true,this.settings,k);this.$dom.slides=this.$dom.slides.parent().children();this.props.total=this.$dom.slides.length;this.props.current=this.settings.initialSlide;if(this.settings.visibleSlides>0){this.props.visible=this.settings.visibleSlides}else{var l=0,m=this.settings.behavior.horizontal?this.$dom.frame.width():this.$dom.frame.height();this.$dom.slides.each(function(){var n=self.settings.behavior.horizontal?c(this).width():c(this).height();if(n>l){l=n}});this.props.visible=Math.round(m/l)}if(this.settings.elements.handles){this.$dom.handlesContainer.html(this._getHandles());this.$dom.handles=this.$dom.handlesContainer.children()}this.resize();this.enable()},resize:function(){var o=this.$dom.frame.width(),n,l=this.settings.behavior.horizontal?o/this.props.visible:o,k,m=this.settings.behavior.horizontal?this.props.total*l:l;this.$dom.slides.width(l);this.$dom.slider.width(m).height("auto");k=this._getHighestSlide();this.$dom.slides.css("min-height",k);n=this.settings.behavior.horizontal?k:this.props.visible*k;this.$dom.frame.height(n);this.goTo(this.props.current,true)},enable:function(){var k=this;if(this.state.enabled){return}if(this.settings.elements.prevNext){this.$dom.nav.on(j,function(n){var p=c(this),l=p.hasClass("state-disabled"),m,o,q;if(l){return}m=p.is(k.$dom.next)?1:-1;o=m*k.settings.animation.step+k.props.current;q=function(){k.goTo(o)};k._handleButtonEvents(n,p,q)})}if(this.settings.elements.handles){this.$dom.handles.on(j,function(l){var n=c(this),p=n.index(),m=k._getSlideIndex(p),o=function(){k.goTo(m)};k._handleButtonEvents(l,n,o)})}if(this.settings.touch.enabled&&i.touch){this._touchEnable()}if(this.settings.behavior.keyboardNav){this.$dom.container.on(g.getNamespacedEvents("keydown"),c.proxy(function(o){var m=c(o.target),r=m.get(0).nodeName.toLowerCase(),l=c.inArray(r,["input","textarea"])!==-1,q=false;if(!(l||o.metaKey||o.ctrlKey)){var n=o.keyCode||o.which,p;if(c.inArray(n,[37,80])!==-1){this.prev();this.$dom.prev.focus();q=true}else{if(c.inArray(n,[39,78])!==-1){this.next();this.$dom.next.focus();q=true}else{if(47<n&&n<58){p=n-49;this.goTo(p);this.$dom.handles.eq(p).focus();q=true}}}}if(q){this._autoplayDisable();o.preventDefault()}},this))}if(this.settings.behavior.autoplay){this.autoplay=setInterval(function(){k.next()},this.settings.behavior.autoplay)}this.state.enabled=true;this._updateNav()},disable:function(k){if(!this.state.enabled){return}if(this.settings.elements.prevNext){this.$dom.nav.off(j)}if(this.settings.elements.handles){this.$dom.handles.off(j)}if(this.settings.touch.enabled&&i.touch){this._touchDisable()}if(this.settings.behavior.keyboardNav){this.$dom.container.off(g.getNamespacedEvents("keydown"))}if(this.settings.behavior.autoplay){this._autoplayDisable()}this.state.enabled=false;this._updateNav()},goTo:function(o,r){var u=this,p=this._getValidatedTarget(o),n=this._getTargetPosition(p),m=r?0:this.settings.animation.duration,t=function(){if(u.settings.events.stop){u.settings.events.stop(p)}u.state.animating=false},l,k,v,q,s;if(!r){this.state.animating=true;if(this.settings.events.start){this.settings.events.start(p)}if(!i.transition){this.$dom.slider.animate(n,m,function(){t()})}else{l=i.transition;k=this.settings.behavior.horizontal?"left":"top";v=g.getNamespacedEvents(g.getTransitionEndEvent());s=this.$dom.slider.css(l);q=k+" "+m/1000+"s ease-in-out";this.$dom.slider.css(l,q);this.$dom.slider.css(n);this.$dom.slider.on(v,function(){u.$dom.slider.off(v);u.$dom.slider.css(l,s);t()})}}else{this.$dom.slider.css(n)}this.props.current=p;this._updateNav()},next:function(){this.goTo(this.props.current+1)},prev:function(){this.goTo(this.props.current-1)},destroy:function(){var k=this.$dom,l=k.slider.data(b+"-css");k.slider.removeClass(b+"-slider").removeData(b).removeData(b+"-css").insertAfter(k.container).css(l);k.slides.removeClass(b+"-slide").removeData(b+"-index").each(function(){var n=c(this),m=n.data(b+"-css");n.css(m)}).removeData(b+"-css");k.container.remove();this.state.enabled=false;this.props.current=0},_autoplayDisable:function(){clearInterval(this.autoplay);this.autoplay=null},_handleButtonEvents:function(m,k,n){switch(m.type){case"keydown":if(!(m.metaKey||m.ctrlKey)){var l=m.keyCode||m.which;if(c.inArray(l,[13,32])!==-1){n();m.preventDefault()}}break;case"touchstart":h=false;k.on("touchmove."+b,function(){h=true});k.on("touchend."+b,function(){k.off("touchmove."+b);k.off("touchend."+b);if(!h){n()}});break;default:n();break}if(this.settings.behavior.autoplay){this._autoplayDisable()}},_getHandles:function(){var k=e.createDocumentFragment();for(var l=0;l<this.props.total;l++){var m=e.createElement("span");m.className=b+"-handle";m.innerHTML=this.settings.text.handle.replace("%index%",(l+1));m.setAttribute("role","button");m.setAttribute("tabindex",0);k.appendChild(m)}return c(k)},_getHighestSlide:function(){var k=0;this.$dom.slides.each(function(){var l=c(this).css("min-height",0).height();if(l>k){k=l}});return k},_getSlideIndex:function(k,l){if(this.settings.behavior.circular){if(!l){this.$dom.slides.each(function(){var o=c(this),m=o.index(),n=o.data(b+"-index");if(n===k){k=m;return false}})}else{k=this.$dom.slides.eq(k).data(b+"-index")}}return k},_getStyles:function(k){var m=k.get(0).style,l={height:m.height,left:m.left,"min-height":m.minHeight,top:m.top,width:m.width},n;if(i.transition){n=i.transition.charAt(0).toLowerCase()+i.transition.substr(1);l[n]=m[n]}return l},_getTargetPosition:function(k){var m=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),n=this.settings.behavior.horizontal?"left":"top",l={};l[n]=-k*m;return l},_getValidatedTarget:function(m){if(!this.settings.behavior.circular){if(m<0){m=0}else{if(m>=(this.props.total-this.props.visible)){m=this.props.total-this.props.visible}}}else{if(m<0){var k=this.props.total+m;if(this._shiftSlides(k,-1)){return 0}}else{if(m>(this.props.total-this.props.visible)){var l=(m-1)-(this.props.total-this.props.visible);if(this._shiftSlides(l,1)){return m-(l+1)}}}}return m},_shiftSlides:function(m,l){var k=(l===-1)?":gt("+(m-1)+")":":lt("+(m+1)+")",q=this.$dom.slides.filter(k);if(q.length>0){var o=this.settings.behavior.horizontal?"left":"top",r=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),p=this.$dom.slider.position(),n={};n[o]=p[o]+l*q.length*r;if(l===-1){q.prependTo(this.$dom.slider)}else{q.appendTo(this.$dom.slider)}this.$dom.slides=this.$dom.slider.children();this.$dom.slider.css(n);return true}else{return false}},_touchEnable:function(){var k=this,n={start:{x:0,y:0},end:{x:0,y:0}},q={start:0,end:0},p={distance:k.settings.touch.thresholds.distance*k.$dom.frame.width(),speed:k.settings.touch.thresholds.speed*k.$dom.frame.width()},o={top:0,left:0},l={};function m(){var r={x:n.end.x-n.start.x,y:n.end.y-n.start.y};if(!k.settings.behavior.horizontal){r={x:r.y,y:r.x}}return r}l["touchstart."+b]=function(s){var r=s.originalEvent.targetTouches[0];n.start.x=r.pageX;n.start.y=r.pageY;o=k.$dom.slider.position();q.start=new Date().getTime();h=false};l["touchmove."+b]=function(v){var u=v.originalEvent.targetTouches[0],w=0,s={},r=k.settings.behavior.horizontal?"left":"top",t;n.end.x=u.pageX;n.end.y=u.pageY;w=m();if(Math.abs(w.x)>Math.abs(w.y)){t=k.settings.behavior.horizontal?o.left:o.top;s[r]=t+w.x;k.$dom.slider.css(s);h=true;v.preventDefault()}};l["touchend."+b]=function(w){if(!h){return}var s=w.originalEvent.targetTouches[0],y=m(),u,x=k.props.current;if(Math.abs(y.x)>Math.abs(y.y)){q.end=new Date().getTime();u=Math.abs(y.x)/(q.end-q.start)*1000;if(Math.abs(y.x)>p.distance||u>p.speed){var r=k.settings.behavior.horizontal?k.$dom.slides.width():k.$dom.slides.height(),t=(y.x>0)?-1:1,v=Math.abs(Math.round(y.x/r));if(v<1&&u>p.speed){v=1}x=k.props.current+t*v}k.goTo(x)}};this.$dom.frame.on(l)},_touchDisable:function(){this.$dom.frame.off(g.getNamespacedEvents("touchstart touchmove touchend"))},_updateNav:function(){if(this.state.enabled){if(this.settings.elements.prevNext){g.enableButton(this.$dom.prev);g.enableButton(this.$dom.next);if(!this.settings.behavior.circular){if(this.props.current===0){g.disableButton(this.$dom.prev)}else{g.enableButton(this.$dom.prev)}if(this.props.current===this.props.total-this.props.visible){g.disableButton(this.$dom.next)}else{g.enableButton(this.$dom.next)}}}if(this.settings.elements.handles){var k=this._getSlideIndex(this.props.current,true),l=(k>0)?":gt("+(k-1)+"):lt("+this.props.visible+")":":lt("+(k+this.props.visible)+")";g.enableButton(this.$dom.handles);this.$dom.handles.removeClass("state-current");this.$dom.handles.filter(l).addClass("state-current")}}else{if(this.settings.elements.prevNext){g.disableButton(this.$dom.prev);g.disableButton(this.$dom.next)}if(this.settings.elements.handles){g.disableButton(this.$dom.handles)}}if(this.settings.elements.counter){var m=this.props.current+1,o=this.props.current+this.props.visible,n;if(this.settings.behavior.circular){m=this.$dom.slides.eq(this.props.current).data(b+"-index")+1}if(this.props.visible>1){if(o>this.props.total){o=this.props.total}m+="-"+o}n=this.settings.text.counter.replace("%current%",m).replace("%total%",this.props.total);this.$dom.counter.text(n)}}};c.fn[b]=function(l){var k=arguments;return this.each(function(){var n=c(this),m=n.data(b);if(m){if(typeof l==="object"){m.update.apply(m,k)}else{m[l].apply(m,Array.prototype.slice.call(k,1))}}else{new f(this,l).init()}})};d[b.charAt(0).toUpperCase()+b.substr(1)]=f})(window,document,jQuery);